# Template file for 'drawio-desktop'
pkgname=drawio-desktop
version=29.5.1
revision=1
build_wrksrc="drawio-desktop-${version}"
archs="x86_64"
hostmakedepends="nodejs"
short_desc="Official electron build of draw.io, a JS editor for general diagramming"
maintainer="Naz <ndpm13@ch-naseem.com>"
license="GPL-3.0-or-later"
homepage="https://www.diagrams.net/"
distfiles="https://github.com/jgraph/drawio-desktop/archive/refs/tags/v${version}.tar.gz>drawio-desktop-v${version}.tar.gz
	https://github.com/jgraph/drawio/archive/refs/tags/v${version}.tar.gz>drawio-v${version}.tar.gz"
checksum="d1d9ef1150f7f79f3d42a61a7ddaa9fd14f0551d134eb2d5c63e9b4d0f83cf7b
	cfd4f1b6fff46e10b552b0a2deba57845da183ace0ab6efcae1b378587bcb725"

post_extract() {
	mv drawio-${version}/* drawio-desktop-${version}/drawio/
}

pre_build() {
	npm i
}

do_build() {
	npm run release-linux -- --linux dir
}

do_install() {
	vcopy dist/linux-unpacked /usr/lib/drawio-desktop
	vmkdir usr/bin
	ln -sf /usr/lib/drawio-desktop/drawio ${DESTDIR}/usr/bin/drawio
	vinstall ${FILESDIR}/drawio.desktop 644 usr/share/applications
}