# Template file for 'cinny-desktop'
pkgname=cinny-desktop
version=4.10.2
revision=2
archs="x86_64"
hostmakedepends="nodejs cargo git pkg-config"
makedepends="openssl-devel libwebkit2gtk41-devel"
depends="libwebkit2gtk41"
short_desc="Yet another matrix client for desktop"
maintainer="Naz <ndpm13@ch-naseem.com>"
license="AGPL-3.0"
homepage="https://cinny.in/"
distfiles="https://github.com/cinnyapp/cinny-desktop/archive/refs/tags/v${version}.tar.gz"
checksum=4afad8c4f0c0205f7c714d7bf4389fa835cbe19d668035a281aa8e285e84ab77

post_extract() {
	git clone --depth 1 https://github.com/cinnyapp/cinny.git cinny --revision refs/tags/v${version}
}

pre_build() {
    cd cinny
    npm ci
    cd ..
    npm ci
}

do_build() {
	npm run tauri build -- --no-bundle
}

do_install() {
    vmkdir opt/cinny-desktop
    vinstall src-tauri/target/release/cinny 755 opt/cinny-desktop

    vmkdir usr/bin
    ln -sf /opt/cinny-desktop/cinny ${DESTDIR}/usr/bin/cinny

    vinstall ${FILESDIR}/cinny.desktop 644 usr/share/applications
    vinstall src-tauri/icons/icon.png 644 usr/share/pixmaps cinny.png
}

post_install() {
    vlicense LICENSE
}
