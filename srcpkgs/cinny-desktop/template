# Template file for 'cinny-desktop'
pkgname=cinny-desktop
version=4.10.3
revision=1
build_wrksrc="cinny-desktop-${version}"
archs="x86_64"
hostmakedepends="nodejs cargo git pkg-config"
makedepends="openssl-devel libwebkit2gtk41-devel"
depends="libwebkit2gtk41"
short_desc="Yet another matrix client for desktop"
maintainer="Naz <ndpm13@ch-naseem.com>"
license="AGPL-3.0"
homepage="https://cinny.in/"
distfiles="https://github.com/cinnyapp/cinny-desktop/archive/refs/tags/v${version}.tar.gz>cinny-desktop-v${version}.tar.gz
	https://github.com/cinnyapp/cinny/archive/refs/tags/v${version}.tar.gz>cinny-v${version}.tar.gz"
checksum="e72b3eabca5105e3bdaf11879b76e1ad9ebc9edb6275b9ceb08623dce46ae5fd
	14c608047316756045725ad5cd6f61699e0e09ba93b7bff26d210668bb840e92"
patch_args="-Np1 -d $build_wrksrc"

post_extract() {
	mv cinny-${version}/* cinny-desktop-${version}/cinny/
}

pre_build() {
    cd cinny
    npm ci --legacy-peer-deps
    cd ..
    npm ci
}

do_build() {
	npm run tauri build -- --no-bundle
}

do_install() {
    vmkdir opt/cinny-desktop
    vinstall src-tauri/target/release/cinny 755 opt/cinny-desktop

    vmkdir usr/bin
    ln -sf /opt/cinny-desktop/cinny ${DESTDIR}/usr/bin/cinny

    vinstall ${FILESDIR}/cinny.desktop 644 usr/share/applications
    vinstall src-tauri/icons/icon.png 644 usr/share/pixmaps cinny.png
}

post_install() {
    vlicense LICENSE
}
