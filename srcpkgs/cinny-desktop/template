# Template file for 'cinny-desktop'
pkgname=cinny-desktop
version=4.10.2
revision=1
archs="x86_64"
hostmakedepends="nodejs cargo git pkg-config"
makedepends="openssl-devel libwebkit2gtk41-devel"
depends="libwebkit2gtk41"
short_desc="Yet another matrix client for desktop"
maintainer="Naz <ndpm13@ch-naseem.com>"
license="AGPL-3.0"
homepage="https://cinny.in/"
distfiles="https://github.com/ndpm13/cinny-desktop/archive/refs/tags/v${version}.tar.gz"
checksum=5f5dcb3164a4bd2cbd7a7655455bcb0f197e99df64ddbcc8966436b9da461c9d

post_extract() {
    git clone --depth 1 https://github.com/cinnyapp/cinny.git cinny
    cd cinny
    git checkout c88cb4bca93e3a376836b8880e5e4c1fa5c7eba2
}

pre_build() {
    cd cinny
    npm ci
    cd ..
    npm ci
}

do_build() {
	npm run tauri build -- --no-bundle
}

do_install() {
    vmkdir opt/cinny-desktop
    vinstall src-tauri/target/release/cinny 755 opt/cinny-desktop

    vmkdir usr/bin
    ln -sf /opt/cinny-desktop/cinny ${DESTDIR}/usr/bin/cinny

    vinstall ${FILESDIR}/cinny.desktop 644 usr/share/applications
    vinstall src-tauri/icons/icon.png 644 usr/share/pixmaps cinny.png
}

post_install() {
    vlicense LICENSE
}
